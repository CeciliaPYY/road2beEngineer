# SIFT(Sift Invariant Feature Transform)

## 1. 简介
一种基于尺度空间的，对图像缩放、旋转、甚至仿射变换保持不变形的图像局部特征描述子

## 2. 特点
1) 对旋转、尺度缩放、亮度变化保持不变性，对视角变化、噪声也存在一定的稳健性；
2) 独特性，信息量丰富，适用于在海量特征数据中进行快速，准确的匹配；
3) 多量性，即使少数几个物体也可以产生大量的Sift特征向量；
4) 可扩展性，可以方便的与其他形式的特征向量进行联合；

## 3.实质及流程
SIFT 算法的实质是在不同的尺度空间上查找关键点，计算关键点的大小、方向、尺度信息，利用这些信息组成关键点对特征点进行描述的问题。它所查找的关键点都是一些十分突出，不会因光照、仿射变换、噪声等因素而变化的“稳定”的特征点，如角点、边缘点、暗区的亮点以及亮区的暗点等。匹配的过程就是对比这些特征点的过程。

## 4.特征提取和匹配具体步骤
1. 生成高斯差分金字塔（DOG金字塔），尺度空间构建；
2. 空间极值点检测（关键点的初步查探）；
3. 稳定关键点的精确定位；
4. 稳定关键点方向信息分配；
5. 关键点描述；
6. 特征点匹配；

## 5.特征提取详细说明
1) 生成高斯差分金字塔（DOG金字塔），尺度空间构建；
主要思想：通过对原始图像进行尺度变换，获得图像多尺度下的尺度空间表示序列，对这些序列进行尺度空间主轮廓的提取，并以该主轮廓作为一种特征向量，实现边缘、角点检测不同分辨率上的关键点提取等。
各尺度下图像的模糊度逐渐变大，能够模拟人在距离目标由近到远时目标物体在视网膜上的形成过程。
尺度空间构建的基础是DOG金字塔，DOG金字塔构建的基础是高斯金字塔。

下面详细介绍一下Sift中尺度空间、高斯金字塔、差分金字塔（DOG金字塔）、图像金字塔。
a) 图像金字塔
以多个分辨率来表示图像的一种结构是图像金字塔，这种结构非常有效，且概念简单。图像金字塔最初用于机器视觉和图像压缩，是一系列以金字塔形状排列的，分辨率逐步降低的图像集合。金字塔的底部是待处理图像的高分辨率表示，而顶部则包含一个低分辨率近似。
获得图像金字塔一般包含两个步骤：
i) 用低通滤波器平滑图像；
ii) 对平滑图像进行采样。

b)高斯金字塔
高斯金字塔是在 SIFT 算子中提出来的概念。它指的并不是一个金字塔，而是有很多组 (Octave) 金字塔构成，并且每组金字塔都包含若干层。
高斯金字塔的构建过程如下：
i) 先将原图像扩大一倍后作为高斯金字塔第 1 组的第 1 层，将第 1 组的第 1 层图像经过高斯卷积之后作为第 1 组的第 2 层，第二层的高斯卷积核函数中 sigma 一般取 1.6；
ii) 将 sigma 乘以一个固定常数 k，得到一个新的平滑因子 sigma' = k * sigma，用它来平滑第 1 组的第 2 层图像，结果作为第 1 组的第 3 层图像；
iii) 这样一直重复下去，最后得到 L 层图像，在同一组中，每一层图像的尺寸都是一样的，只是平滑系数不一样。它们对应的平滑系数为0, sigma, k * sigma, k**2 * sigma, ..., k**(L-2)*sigma;
iv) 将第 1 组倒数第 3 层的图像做比例因子为 2 的降采样，得到的图像作为第 2 组的第 1 层，然后对第 2 组的第 1 层做同 (iii) 中一样的事情，如此得到第 2 组的 L 层图像，同样的第 2 组同组内尺寸一样，但是同第 1 组相比是第 1 组的一半；
这样反复执行，就可以一共得到 O 组，每组 L，共计 O * L个图像，这些图像就一起构成了高斯金字塔。

c) 尺度空间
图像的尺度空间解决的问题是如何对图像在所有尺度下描述的问题。
在高斯金字塔中一共生成 O 组 L 层不同尺度的图像，这两个量合起来 (O,L)就构成了高斯金字塔的尺度空间，也就是说，以高斯金字塔的组 O 作为二维坐标系的一个坐标，不同层 L 作为另一个坐标，则给定的一组坐标 (O,L) 就可以唯一确定高斯金字塔中的一幅图像。

d)差分金字塔（DOG金字塔）
差分金字塔是在高斯金字塔的基础上构建起来的，其实生成高斯金字塔的目的就是为了生成差分金字塔。
差分金字塔的第 1 组的第 1 层就是由高斯金字塔的第 1 组的第 2 层减第 1 组的第 1 层得到的。以此类推，逐组逐层生成每一个差分图像，所有差分图像构成差分金字塔。概括为差分金字塔的第 O 组 第 L 层图像就是由高斯金字塔的第 O 组 第 L+1 层减去第 O 组 第 L 层得到的。
每一组在层数上，差分金字塔比高斯金字塔少一层。后续SIFT特征点的提取都是在差分金字塔上进行的。


2) 空间极值点检测（关键点的初步查探）
为了寻找 DOG 函数的极值点，每一个像素点要和它所有的相邻点比较，看其是否比它的图像域和尺度空间域的相邻点大或小。
在二维图像空间，中心点与它 3*3 邻域内的 8 个点作比较，在同一组内的尺度空间上，中心点和上下相邻的两层图像的 2*9 个点作比较，如此可以保证检测到的关键点在尺度空间和二维空间上都是局部极值点。

3）稳定关键点的精确定位
这一步实质上要去掉 DOG 局部曲率非常不对称的像素。
通过拟合三维二次函数以精确确定关键点的位置和尺度，同时去除对比度低的关键点和不稳定的边缘响应点（因为DOG算子会产生较强的边缘效应），以增强匹配稳定性、提升抗噪能力，在这里使用近似 Harris 角点检测器。

4. 稳定关键点方向信息分配
稳定的极值点是在不同尺度空间下提取的，这保证了关键点的尺度不变性。为关键点分配方向信息所要解决的问题是使得关键点对 图像角度 和 旋转 具有不变性。方向的分配是通过求每个极值点的梯度来实现的。
对于任一关键点，其梯度幅值表述为：
m(x,y) = sqrt((L(x+1,y)-L(x-1,y))**2 - (L(x,y+1)-L(x,y-1))**2)
梯度方向为：
theta(x,y) = tan^(-1)[(L(x+1,y)-L(x-1,y))/(L(x,y+1)-L(x,y-1))]
分配给关键点的方向并不直接是关键点的梯度方向，而是按照一种梯度方向直方图给出的。
具体方法如下：计算以关键点为中心的邻域窗口内所有点的梯度方向，当然梯度方向一定是介于[0,360°]之内的，将这些梯度方向归一化到 36 个方向内，每个方向代表了 10° 的范围。（论文中还提及了用高斯函数对直方图进行平滑，减少突变的影响）。然后用直方图统计邻域像素的梯度方向。直方图的峰值则代表了该关键点处邻域梯度的主方向，即作为该关键点的方向。若在梯度直方图中存在一个相当于主峰值 80% 能量的峰值，则将这个方向认为是关键点的辅方向。辅方向的设计可以增强匹配点的鲁棒性。论文中指出，大概有 15% 的关键点具有辅方向，而恰恰是这 15% 的关键点对稳定匹配起到关键作用。

5. 关键点描述
对关键点的描述是后续实现匹配的关键步骤，描述其实就是一种以数学方式定义关键的过程。描述子不但包含关键点，也包括关键点周围对其有贡献的邻域点。
描述的思路如下：
对关键点周围像素区域分块，计算块内梯度直方图，生成具有独特性的向量，该向量是对该区域图像信息的一种抽象表述。
对于 2*2 块，对于每块的所有像素点可以利用公式求得它们的梯度幅值与梯度方向，箭头表示方向，箭头长度表示幅值，然后用高斯窗口对其进行加权运算。越靠近关键点的像素梯度方向信息贡献越大。然后在每块最终取 8 个方向，计算梯度方向直方图，绘制每个梯度方向的累加值，即可形成一个种子点。此种情况下一个关键点由 2 * 2 个种子点组成，每个种子点有 8 个方向向量信息。这种邻域方向性信息联合的思想增强了算法抗噪声的能力，同时对于含有定位误差的特征匹配也提供了较好的容错性。
这样就可以生成一个 2 * 2 * 8 = 32 维的描述子，每一维都可以表示 2 * 2 个格子中的一个的 scale / orientation，将这个向量归一化后，就进一步去除了光照的影响。
作者在论文中表明 4 * 4 * 8 = 128 维的描述子效果最好。

6. 特征点的匹配
特征点的匹配是通过计算两组特征点的 128 维的关键点的欧式距离实现的。欧式距离越小，相似度越高。当欧氏距离小于设定的阈值时，则可以判定为匹配成功。


